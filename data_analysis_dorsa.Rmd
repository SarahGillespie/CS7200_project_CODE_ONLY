---
title: "data_analysis_dorsa"
output: html_document
date: "2023-11-25"
---
```{r}
library(tidyverse)
library(lme4)
library(sjPlot)
library(emmeans)
library(magrittr) # needs to be run every time you start R and want to use %>%
library(dplyr)    # alternatively, this also loads %>%
library(AID)
library(multcomp)
library(car)
```

```{r}
data <- read.csv('data_full.csv')

data <- data %>% 
  drop_na(group) %>% # dropped participants who were not in either control or treatment
  mutate(PARTICIPANT = as.factor(PARTICIPANT),
      holiday = as.factor(holiday_months_dummy_variable), 
        activity = (Ambulation + Upright..Other.) / HOURS_COVERAGE,
        holiday_treatment = as.factor(ifelse(group == 'Treatment' & holiday == 1, 1, 0)),
        holiday_group = as.factor(ifelse(group == 'Treatment' & holiday == 1, 1,
                                         ifelse(group == 'Treatment' & holiday == 0, 2,
                                                ifelse(group == 'Control' & holiday == 1, 3, 4)))),
      month = as.factor(format(as.Date(DATE, format="%Y-%m-%d"),"%m")))


holiday_treatment_df = data[data$holiday_group==1,]
non_holiday_treatment_df = data[data$holiday_group==2,]
holiday_control_df = data[data$holiday_group==3,]
non_holiday_control_df =data[data$holiday_group==4,]


hist(holiday_treatment_df$activity) 
shapiro.test(holiday_treatment_df$activity) 
print(length(holiday_treatment_df))

hist(non_holiday_treatment_df$activity) 
shapiro.test(non_holiday_treatment_df$activity) 
print(length(non_holiday_treatment_df))

hist(holiday_control_df$activity) 
shapiro.test(holiday_control_df$activity) 
print(length(holiday_control_df))

hist(non_holiday_control_df$activity) 
shapiro.test(non_holiday_control_df$activity)
print(length(non_holiday_control_df))

#normalizing to use anova 
out1=boxcoxnc(holiday_treatment_df$activity, lambda2 = 0.001)
holiday_treatment_df$activity = out1$tf.data 

out2=boxcoxnc(non_holiday_treatment_df$activity, lambda2 = 0.001)
non_holiday_treatment_df$activity = out2$tf.data

out3=boxcoxnc(holiday_control_df$activity, lambda2 = 0.001)
holiday_control_df$activity = out3$tf.data

out4=boxcoxnc(non_holiday_control_df$activity, lambda2 = 0.001)
non_holiday_control_df$activity = out4$tf.data


fulldf = rbind(holiday_treatment_df,non_holiday_treatment_df,holiday_control_df,non_holiday_control_df)
#some of these are normal and the histogram looks good so im just gonna go with it? 
res.aov <- aov(activity ~ holiday_group, data = fulldf)
# Summary of the analysis
summary(res.aov)
#code: 'Treatment' & holiday == 1, 'Treatment' & holiday == 0, 2,
# Control' & holiday == 1, 3, Control' & holiday == 0, 4
TukeyHSD(res.aov)

summary(glht(res.aov, linfct = mcp(holiday_group = "Tukey")))

leveneTest(activity ~ holiday_group, data = fulldf)
